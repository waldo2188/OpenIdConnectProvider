{% extends "WaldoOpenIdConnectEnduserBundle:Account:index.html.twig" %}

{% block title %}{{ parent() }} - {% trans %}Applications access list{% endtrans %}{% endblock title %}

{% macro clientName(client) %}
    {% if client.clientUri is not null %}
        <a href="{{ client.clientUri }}" title="{% trans with {'%clientName%': client.clientName}%}Go to %clientName%'s web site{% endtrans %}">{{ client.clientName }}</a>
    {% else %}
        {{ client.clientName }}
    {% endif %}
{% endmacro %}

{% macro scopes(scopes) %}
    {% set scope_meaning = {
        'profile' : {link: 'profile', title: 'profile data'},
        'email' :  {link: 'account', title: 'email'},
        'address' :  {link: 'address', title: 'address'},
        'phone' :  {link: 'profile', title: 'phone number'}
    } %}
    {% for scope in scopes %}
        {% if scope != "openid" %}
        <a href="{{ path("oicp_account_index") }}#{{ scope_meaning[scope].link }}" title="{% trans with {'%scope%': scope_meaning[scope].title} %}Read your %scope%{% endtrans %}" data-toggle="tooltip">{{ scope }}</a>{% if loop.last != true %},{% endif %}
        {% endif %}
    {% endfor %}
{% endmacro %}


{% block accountContent %}

    <h1>{% trans %}Applications access list{% endtrans %}</h1>
    
    <p>{% trans %}You have granted the following applications to access to your account informations.{% endtrans %}</p>

    <ul class="token-list">
        {% for token in tokenList %}
            <li>
                {{ _self.clientName(token.client) }} â€” <span class="scope">{{ _self.scopes(token.scope) }}</span> <span class="update-on pull-right">{% trans %}Last used on{% endtrans %} {{ token.issuedAt|date() }}</span>
            </li>
        {% else %}
            <li>{% trans %}Nothing for the moment{% endtrans %}</li>
        {% endfor %}
    </ul>
    
    
{% endblock accountContent %}

{% block javascripts %}
    {{ parent() }}
<script type="text/javascript">   
$(document).ready(function(){
    $('ul.token-list li a[data-toggle="tooltip"]').tooltip({placement:'bottom'});
});
</script>
{% endblock %}
